// Code generated by goa v3.14.1, DO NOT EDIT.
//
// Zerolog logger implementation
//
// Command:
// $ goa gen apisvr/design -o ./services

package log

import (
	"fmt"
	"os"

	"svrlib/log"
)

// Logger is an adapted zerologger
type Logger struct {
	*log.Logger
}

// New creates a new zerologger
func New(serviceName string, isDebug bool) *Logger {
	logLevel := log.InfoLevel
	if isDebug {
		logLevel = log.DebugLevel
	}
	log.SetGlobalLevel(logLevel)
	logger := *log.NewServiceLogger(os.Stderr, serviceName)
	return &Logger{&logger}
}

// Log is called by the log middleware to log HTTP requests key values
func (logger *Logger) Log(keyvals ...interface{}) error {
	fields := FormatFields(keyvals)
	logger.Info().Fields(fields)
	return nil
}

// formatFields formats input keyvals
// ref: https://github.com/goadesign/goa/blob/v1/logging/logrus/adapter.go#L64
func FormatFields(keyvals []interface{}) map[string]interface{} {
	n := (len(keyvals) + 1) / 2
	res := make(map[string]interface{}, n)
	for i := 0; i < len(keyvals); i += 2 {
		k := keyvals[i]
		var v interface{}
		if i+1 < len(keyvals) {
			v = keyvals[i+1]
		}
		res[fmt.Sprintf("%v", k)] = v
	}
	return res
}
