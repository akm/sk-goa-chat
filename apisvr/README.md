# Chat API Server

## ディレクトリ

パス     | 説明
--------|------------------
design  | goa のAPI定義のファイル群
lib     | 他のアプリケーションでも使えるかもしれないパッケージ群
models  | アプリケーション固有のモデルのパッケージ群
services | goaのサービスのファイル群と、cmd ディレクトリ と gen ディレクトリ
testlib  | 他のアプリケーションでも使えるかもしれないテスト専用のパッケージ群

### 何をどこに実装するべきか

- アプリケーションドメインのもの
    - goa に依存するもの ==> services
    - 業務モデルに依存するもの ==> models
    - 他のライブラリの使い方を限定するもの ==> lib/(オリジナルのパッケージ名)
         - 例えば database/sql ならば lib/sql
         - aliases.go を定義して、そのまま公開するものはそこにエイリアスを定義すること
- 他のアプリケーションでも使えるかもしれないもの
    - (テスト以外で)新しい機能を提供するもの ==> lib/(適切な名前)
    - lib/*** のパッケージをテストで使いやすくするためのライブラリ ==> testlib/(適切な名前)
    - テストについて新しい機能を提供するもの ==> testlib/(適切な名前)

### テストをどのように定義するか

- 基本的に対象のコードと同じディレクトリに *_test.go を配置する
    - パッケージ名は基本的に同一のパッケージ名を使うが、同一のディレクトリでおいて敢えて `_test` として別のパッケージとしてテストするのもOK
    - テストが複雑になる場合は以下の何れかの方針とする
        - `(テスト対象ファイル名 - 拡張子)_test`` ディレクトリを追加し、配下にテストファイルを作成する
            パッケージ名は `(テスト対象ファイル名 - 拡張子)_test` からアンダースコアを削除したもの
- 例外1 models
    - models は sqlboiler が生成するディレクトリであり、テストも生成されるが、それでもテストを書きたい場合には tests/models ディレクトリを作成し、テストを追加する
- 例外2 外部のライブラリ
    - lib 以下ではなく、外部のライブラリの挙動を確認したい場合 tests/(ライブラリ名) ディレクトリを作成し、テストを追加する
